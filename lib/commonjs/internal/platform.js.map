{"version":3,"names":["RNIapIos","RNIapIosSk2","RNIapModule","RNIapAmazonModule","NativeModules","isIos","Platform","OS","isAndroid","isAmazon","isPlay","androidNativeModule","setAndroidNativeModule","nativeModule","checkNativeAndroidAvailable","Error","ErrorCode","E_IAP_NOT_AVAILABLE","getAndroidModule","getAndroidModuleType","module","getNativeModule","getIosModule","iosNativeModule","isStorekit2Avaiable","isAvailable","isIosStorekit2","setIosNativeModule","storekit2Mode","disable","console","warn","storekit1Mode","storekitHybridMode","info","checkNativeIOSAvailable"],"sources":["platform.ts"],"sourcesContent":["import {NativeModules, Platform} from 'react-native';\n\nimport {ErrorCode} from '../purchaseError';\n\nconst {RNIapIos, RNIapIosSk2, RNIapModule, RNIapAmazonModule} = NativeModules;\n\nexport const isIos = Platform.OS === 'ios';\nexport const isAndroid = Platform.OS === 'android';\nexport const isAmazon = isAndroid && !!RNIapAmazonModule;\nexport const isPlay = isAndroid && !!RNIapModule;\n\n// Android\n\nlet androidNativeModule = RNIapModule;\n\nexport const setAndroidNativeModule = (\n  nativeModule: typeof RNIapModule,\n): void => {\n  androidNativeModule = nativeModule;\n};\n\nexport const checkNativeAndroidAvailable = (): void => {\n  if (!RNIapModule && !RNIapAmazonModule) {\n    throw new Error(ErrorCode.E_IAP_NOT_AVAILABLE);\n  }\n};\n\n/**\n * If changing the typings of `getAndroidModule` to accommodate extra modules,\n * make sure to update `getAndroidModuleType`.\n */\nexport const getAndroidModule = ():\n  | typeof RNIapModule\n  | typeof RNIapAmazonModule => {\n  checkNativeAndroidAvailable();\n\n  return androidNativeModule\n    ? androidNativeModule\n    : RNIapModule\n    ? RNIapModule\n    : RNIapAmazonModule;\n};\n\n/**\n * Returns whether the Android in-app-purchase code is using the Android,\n * Amazon, or another store.\n */\nexport const getAndroidModuleType = (): 'android' | 'amazon' | null => {\n  const module = getAndroidModule();\n  switch (module) {\n    case RNIapModule:\n      return 'android';\n    case RNIapAmazonModule:\n      return 'amazon';\n    default:\n      return null;\n  }\n};\n\nexport const getNativeModule = ():\n  | typeof RNIapModule\n  | typeof RNIapAmazonModule\n  | typeof RNIapIos\n  | typeof RNIapIosSk2 => {\n  return isAndroid ? getAndroidModule() : getIosModule();\n};\n\n// iOS\n\nlet iosNativeModule: typeof RNIapIos | typeof RNIapIosSk2 = RNIapIos;\n\nexport const isStorekit2Avaiable = (): boolean =>\n  isIos && RNIapIosSk2?.isAvailable() === 1;\n\nexport const isIosStorekit2 = () =>\n  isIos &&\n  !!iosNativeModule &&\n  iosNativeModule === RNIapIosSk2 &&\n  isStorekit2Avaiable();\n\nexport const setIosNativeModule = (\n  nativeModule: typeof RNIapIos | typeof RNIapIosSk2,\n): void => {\n  iosNativeModule = nativeModule;\n};\n\nexport const storekit2Mode = () => {\n  iosNativeModule = RNIapIosSk2;\n  if (isStorekit2Avaiable()) {\n    RNIapIos.disable();\n    return true;\n  }\n  if (isIos) {\n    console.warn('Storekit 2 is not available on this device');\n    return false;\n  }\n  return true;\n};\n\nexport const storekit1Mode = () => {\n  iosNativeModule = RNIapIos;\n  if (isStorekit2Avaiable()) {\n    RNIapIosSk2.disable();\n    return true;\n  }\n  return false;\n};\n\nexport const storekitHybridMode = () => {\n  if (isStorekit2Avaiable()) {\n    iosNativeModule = RNIapIosSk2;\n    console.info('Using Storekit 2');\n    return true;\n  } else {\n    iosNativeModule = RNIapIos;\n    console.info('Using Storekit 1');\n    return true;\n  }\n};\n\nconst checkNativeIOSAvailable = (): void => {\n  if (!RNIapIos && !isStorekit2Avaiable()) {\n    throw new Error(ErrorCode.E_IAP_NOT_AVAILABLE);\n  }\n};\n\nexport const getIosModule = (): typeof RNIapIos | typeof RNIapIosSk2 => {\n  checkNativeIOSAvailable();\n\n  return iosNativeModule\n    ? iosNativeModule\n    : RNIapIosSk2\n    ? RNIapIosSk2\n    : RNIapIos;\n};\n"],"mappings":"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"}