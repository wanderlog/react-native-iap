{"version":3,"names":["useIAP","connected","products","promotedProductsIOS","subscriptions","purchaseHistory","availablePurchases","currentPurchase","currentPurchaseError","initConnectionError","setProducts","setSubscriptions","setAvailablePurchases","setPurchaseHistory","setCurrentPurchase","setCurrentPurchaseError","useIAPContext","getProducts","useCallback","skus","iapGetProducts","getSubscriptions","iapGetSubscriptions","getAvailablePurchases","iapGetAvailablePurchases","getPurchaseHistory","iapGetPurchaseHistory","finishTransaction","purchase","isConsumable","developerPayloadAndroid","iapFinishTransaction","err","productId","undefined","requestPurchase","iapRequestPurchase","requestSubscription","iapRequestSubscription"],"sources":["useIAP.ts"],"sourcesContent":["import {useCallback} from 'react';\n\nimport {\n  finishTransaction as iapFinishTransaction,\n  getAvailablePurchases as iapGetAvailablePurchases,\n  getProducts as iapGetProducts,\n  getPurchaseHistory as iapGetPurchaseHistory,\n  getSubscriptions as iapGetSubscriptions,\n  requestPurchase as iapRequestPurchase,\n  requestSubscription as iapRequestSubscription,\n} from '../iap';\nimport type {PurchaseError} from '../purchaseError';\nimport type {Product, Purchase, PurchaseResult, Subscription} from '../types';\n\nimport {useIAPContext} from './withIAPContext';\n\ntype IAP_STATUS = {\n  connected: boolean;\n  products: Product[];\n  promotedProductsIOS: Product[];\n  subscriptions: Subscription[];\n  purchaseHistory: Purchase[];\n  availablePurchases: Purchase[];\n  currentPurchase?: Purchase;\n  currentPurchaseError?: PurchaseError;\n  initConnectionError?: Error;\n  finishTransaction: ({\n    purchase,\n    isConsumable,\n    developerPayloadAndroid,\n  }: {\n    purchase: Purchase;\n    isConsumable?: boolean;\n    developerPayloadAndroid?: string;\n  }) => Promise<string | boolean | PurchaseResult | void>;\n  getAvailablePurchases: () => Promise<void>;\n  getPurchaseHistory: () => Promise<void>;\n  getProducts: ({skus}: {skus: string[]}) => Promise<void>;\n  getSubscriptions: ({skus}: {skus: string[]}) => Promise<void>;\n  requestPurchase: typeof iapRequestPurchase;\n  requestSubscription: typeof iapRequestSubscription;\n};\n\nexport const useIAP = (): IAP_STATUS => {\n  const {\n    connected,\n    products,\n    promotedProductsIOS,\n    subscriptions,\n    purchaseHistory,\n    availablePurchases,\n    currentPurchase,\n    currentPurchaseError,\n    initConnectionError,\n    setProducts,\n    setSubscriptions,\n    setAvailablePurchases,\n    setPurchaseHistory,\n    setCurrentPurchase,\n    setCurrentPurchaseError,\n  } = useIAPContext();\n\n  const getProducts = useCallback(\n    async ({skus}: {skus: string[]}): Promise<void> => {\n      setProducts(await iapGetProducts({skus}));\n    },\n    [setProducts],\n  );\n\n  const getSubscriptions = useCallback(\n    async ({skus}: {skus: string[]}): Promise<void> => {\n      setSubscriptions(await iapGetSubscriptions({skus}));\n    },\n    [setSubscriptions],\n  );\n\n  const getAvailablePurchases = useCallback(async (): Promise<void> => {\n    setAvailablePurchases(await iapGetAvailablePurchases());\n  }, [setAvailablePurchases]);\n\n  const getPurchaseHistory = useCallback(async (): Promise<void> => {\n    setPurchaseHistory(await iapGetPurchaseHistory());\n  }, [setPurchaseHistory]);\n\n  const finishTransaction = useCallback(\n    async ({\n      purchase,\n      isConsumable,\n      developerPayloadAndroid,\n    }: {\n      purchase: Purchase;\n      isConsumable?: boolean;\n      developerPayloadAndroid?: string;\n    }): Promise<string | boolean | PurchaseResult | void> => {\n      try {\n        return await iapFinishTransaction({\n          purchase,\n          isConsumable,\n          developerPayloadAndroid,\n        });\n      } catch (err) {\n        throw err;\n      } finally {\n        if (purchase.productId === currentPurchase?.productId) {\n          setCurrentPurchase(undefined);\n        }\n\n        if (purchase.productId === currentPurchaseError?.productId) {\n          setCurrentPurchaseError(undefined);\n        }\n      }\n    },\n    [\n      currentPurchase?.productId,\n      currentPurchaseError?.productId,\n      setCurrentPurchase,\n      setCurrentPurchaseError,\n    ],\n  );\n\n  return {\n    connected,\n    products,\n    promotedProductsIOS,\n    subscriptions,\n    purchaseHistory,\n    availablePurchases,\n    currentPurchase,\n    currentPurchaseError,\n    initConnectionError,\n    finishTransaction,\n    getProducts,\n    getSubscriptions,\n    getAvailablePurchases,\n    getPurchaseHistory,\n    requestPurchase: iapRequestPurchase,\n    requestSubscription: iapRequestSubscription,\n  };\n};\n"],"mappings":";;;;;;;AAAA;;AAEA;;AAYA;;AA6BO,MAAMA,MAAM,GAAG,MAAkB;EACtC,MAAM;IACJC,SADI;IAEJC,QAFI;IAGJC,mBAHI;IAIJC,aAJI;IAKJC,eALI;IAMJC,kBANI;IAOJC,eAPI;IAQJC,oBARI;IASJC,mBATI;IAUJC,WAVI;IAWJC,gBAXI;IAYJC,qBAZI;IAaJC,kBAbI;IAcJC,kBAdI;IAeJC;EAfI,IAgBF,IAAAC,6BAAA,GAhBJ;EAkBA,MAAMC,WAAW,GAAG,IAAAC,kBAAA,EAClB,cAAmD;IAAA,IAA5C;MAACC;IAAD,CAA4C;IACjDT,WAAW,CAAC,MAAM,IAAAU,gBAAA,EAAe;MAACD;IAAD,CAAf,CAAP,CAAX;EACD,CAHiB,EAIlB,CAACT,WAAD,CAJkB,CAApB;EAOA,MAAMW,gBAAgB,GAAG,IAAAH,kBAAA,EACvB,eAAmD;IAAA,IAA5C;MAACC;IAAD,CAA4C;IACjDR,gBAAgB,CAAC,MAAM,IAAAW,qBAAA,EAAoB;MAACH;IAAD,CAApB,CAAP,CAAhB;EACD,CAHsB,EAIvB,CAACR,gBAAD,CAJuB,CAAzB;EAOA,MAAMY,qBAAqB,GAAG,IAAAL,kBAAA,EAAY,YAA2B;IACnEN,qBAAqB,CAAC,MAAM,IAAAY,0BAAA,GAAP,CAArB;EACD,CAF6B,EAE3B,CAACZ,qBAAD,CAF2B,CAA9B;EAIA,MAAMa,kBAAkB,GAAG,IAAAP,kBAAA,EAAY,YAA2B;IAChEL,kBAAkB,CAAC,MAAM,IAAAa,uBAAA,GAAP,CAAlB;EACD,CAF0B,EAExB,CAACb,kBAAD,CAFwB,CAA3B;EAIA,MAAMc,iBAAiB,GAAG,IAAAT,kBAAA,EACxB,eAQyD;IAAA,IARlD;MACLU,QADK;MAELC,YAFK;MAGLC;IAHK,CAQkD;;IACvD,IAAI;MACF,OAAO,MAAM,IAAAC,sBAAA,EAAqB;QAChCH,QADgC;QAEhCC,YAFgC;QAGhCC;MAHgC,CAArB,CAAb;IAKD,CAND,CAME,OAAOE,GAAP,EAAY;MACZ,MAAMA,GAAN;IACD,CARD,SAQU;MACR,IAAIJ,QAAQ,CAACK,SAAT,MAAuB1B,eAAvB,aAAuBA,eAAvB,uBAAuBA,eAAe,CAAE0B,SAAxC,CAAJ,EAAuD;QACrDnB,kBAAkB,CAACoB,SAAD,CAAlB;MACD;;MAED,IAAIN,QAAQ,CAACK,SAAT,MAAuBzB,oBAAvB,aAAuBA,oBAAvB,uBAAuBA,oBAAoB,CAAEyB,SAA7C,CAAJ,EAA4D;QAC1DlB,uBAAuB,CAACmB,SAAD,CAAvB;MACD;IACF;EACF,CA3BuB,EA4BxB,CACE3B,eADF,aACEA,eADF,uBACEA,eAAe,CAAE0B,SADnB,EAEEzB,oBAFF,aAEEA,oBAFF,uBAEEA,oBAAoB,CAAEyB,SAFxB,EAGEnB,kBAHF,EAIEC,uBAJF,CA5BwB,CAA1B;EAoCA,OAAO;IACLd,SADK;IAELC,QAFK;IAGLC,mBAHK;IAILC,aAJK;IAKLC,eALK;IAMLC,kBANK;IAOLC,eAPK;IAQLC,oBARK;IASLC,mBATK;IAULkB,iBAVK;IAWLV,WAXK;IAYLI,gBAZK;IAaLE,qBAbK;IAcLE,kBAdK;IAeLU,eAAe,EAAEC,oBAfZ;IAgBLC,mBAAmB,EAAEC;EAhBhB,CAAP;AAkBD,CA/FM"}