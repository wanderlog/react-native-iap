{"version":3,"names":["NativeEventEmitter","transactionSk2Map","isIosStorekit2","getAndroidModule","getIosModule","getNativeModule","isAndroid","isIos","purchaseUpdatedListener","listener","eventEmitter","proxyListener","event","emitterSubscription","addListener","startListening","purchaseErrorListener","promotedProductListener","transactionListener"],"sources":["eventEmitter.ts"],"sourcesContent":["import {EmitterSubscription, NativeEventEmitter} from 'react-native';\n\nimport {TransactionEvent, transactionSk2Map} from './types/appleSk2';\nimport {isIosStorekit2} from './iap';\nimport {\n  getAndroidModule,\n  getIosModule,\n  getNativeModule,\n  isAndroid,\n  isIos,\n} from './internal';\nimport type {PurchaseError} from './purchaseError';\nimport type {Purchase} from './types';\n\n/**\n * Add IAP purchase event\n * Register a callback that gets called when the store has any updates to purchases that have not yet been finished, consumed or acknowledged. Returns a React Native `EmitterSubscription` on which you can call `.remove()` to stop receiving updates. Register you listener as soon as possible and react to updates at all times.\n\n## Signature\n\n```ts\npurchaseUpdatedListener((purchase: Purchase) => {});\n```\n\n## Usage\n\n```tsx\nimport React, {useEffect} from 'react';\nimport {View} from 'react-native';\nimport {purchaseUpdatedListener} from 'react-native-iap';\n\nconst App = () => {\n  useEffect(() => {\n    const subscription = purchaseUpdatedListener((purchase: Purchase) => {\n      console.log(purchase);\n    });\n\n    return () => {\n      subscription.remove();\n    };\n  }, []);\n\n  return <View />;\n};\n```\n */\nexport const purchaseUpdatedListener = (\n  listener: (event: Purchase) => void,\n) => {\n  const eventEmitter = new NativeEventEmitter(getNativeModule());\n  const proxyListener = isIosStorekit2()\n    ? (event: Purchase) => {\n        listener(transactionSk2Map(event as any));\n      }\n    : listener;\n  const emitterSubscription = eventEmitter.addListener(\n    'purchase-updated',\n    proxyListener,\n  );\n\n  if (isAndroid) {\n    getAndroidModule().startListening();\n  }\n\n  return emitterSubscription;\n};\n\n/**\n * Add IAP purchase error event\n * Register a callback that gets called when there has been an error with a purchase. Returns a React Native `EmitterSubscription` on which you can call `.remove()` to stop receiving updates.\n\n## Signature\n\n```ts\npurchaseErrorListener((error: PurchaseError) => {});\n```\n\n## Usage\n\n```tsx\nimport React, {useEffect} from 'react';\nimport {View} from 'react-native';\nimport {purchaseErrorListener} from 'react-native-iap';\n\nconst App = () => {\n  useEffect(() => {\n    const subscription = purchaseErrorListener((error: PurchaseError) => {\n      console.log(error);\n    });\n\n    return () => {\n      subscription.remove();\n    };\n  }, []);\n\n  return <View />;\n};\n```\n\n */\nexport const purchaseErrorListener = (\n  listener: (error: PurchaseError) => void,\n): EmitterSubscription => {\n  const eventEmitter = new NativeEventEmitter(getNativeModule());\n  return eventEmitter.addListener('purchase-error', listener);\n};\n\n/**\n * Add IAP promoted subscription event\n * Add IAP promoted subscription event.\n\n## Signature\n\n```ts\npromotedProductListener((productId?: string) => {});\n```\n\n## Usage\n\n```tsx\nimport React, {useEffect} from 'react';\nimport {View} from 'react-native';\nimport {promotedProductListener} from 'react-native-iap';\n\nconst App = () => {\n  useEffect(() => {\n    const subscription = promotedProductListener((productId) => {\n      console.log(productId);\n    });\n\n    return () => {\n      subscription.remove();\n    };\n  }, []);\n\n  return <View />;\n};\n```\n\n *\n * @platform iOS\n */\nexport const promotedProductListener = (listener: () => void) => {\n  if (isIos && !isIosStorekit2()) {\n    const eventEmitter = new NativeEventEmitter(getIosModule());\n    return eventEmitter.addListener('iap-promoted-product', listener);\n  }\n\n  return null;\n};\n\n/**\n * Updated transactions for iOS Sk2\n * Register a callback that gets called when the store has any updates to transactions related to purchases that have not yet been finished, consumed or acknowledged. \n * Returns a React Native `EmitterSubscription` on which you can call `.remove()` to stop receiving updates. Register you listener as soon as possible and react to updates at all times.\n\n**Warning**\nThis is only available for iOS 15 and higher and Storekit 2 is activated\n\n## Signature\n\n```ts\npurchaseUpdatedListener((transactionOrError: TransactionOrError) => {});\n```\n\n## Usage\n\n```tsx\nimport React, {useEffect} from 'react';\nimport {View} from 'react-native';\nimport {purchaseUpdatedListener} from 'react-native-iap';\n\nconst App = () => {\n  useEffect(() => {\n    const subscription = purchaseUpdatedListener((transactionOrError: TransactionOrError) => {\n      if(transactionOrError.transaction){\n        console.log(\"There's an update to a transaction\", transactionOrError.transaction);\n      }else{\n        console.log(\"There's been an error with a received transaction\")\n      }\n    });\n\n    return () => {\n      subscription.remove();\n    };\n  }, []);\n\n  return <View />;\n};\n```\n *\n * @platform iOS (Sk2)\n */\nexport const transactionListener = (\n  listener: (event: TransactionEvent) => void,\n) => {\n  if (isIos && isIosStorekit2()) {\n    const eventEmitter = new NativeEventEmitter(getIosModule());\n    return eventEmitter.addListener('iap-transaction-updated', listener);\n  }\n\n  return null;\n};\n"],"mappings":"AAAA,SAA6BA,kBAA7B,QAAsD,cAAtD;AAEA,SAA0BC,iBAA1B,QAAkD,kBAAlD;AACA,SAAQC,cAAR,QAA6B,OAA7B;AACA,SACEC,gBADF,EAEEC,YAFF,EAGEC,eAHF,EAIEC,SAJF,EAKEC,KALF,QAMO,YANP;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,uBAAuB,GAClCC,QADqC,IAElC;EACH,MAAMC,YAAY,GAAG,IAAIV,kBAAJ,CAAuBK,eAAe,EAAtC,CAArB;EACA,MAAMM,aAAa,GAAGT,cAAc,KAC/BU,KAAD,IAAqB;IACnBH,QAAQ,CAACR,iBAAiB,CAACW,KAAD,CAAlB,CAAR;EACD,CAH+B,GAIhCH,QAJJ;EAKA,MAAMI,mBAAmB,GAAGH,YAAY,CAACI,WAAb,CAC1B,kBAD0B,EAE1BH,aAF0B,CAA5B;;EAKA,IAAIL,SAAJ,EAAe;IACbH,gBAAgB,GAAGY,cAAnB;EACD;;EAED,OAAOF,mBAAP;AACD,CAnBM;AAqBP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMG,qBAAqB,GAChCP,QADmC,IAEX;EACxB,MAAMC,YAAY,GAAG,IAAIV,kBAAJ,CAAuBK,eAAe,EAAtC,CAArB;EACA,OAAOK,YAAY,CAACI,WAAb,CAAyB,gBAAzB,EAA2CL,QAA3C,CAAP;AACD,CALM;AAOP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMQ,uBAAuB,GAAIR,QAAD,IAA0B;EAC/D,IAAIF,KAAK,IAAI,CAACL,cAAc,EAA5B,EAAgC;IAC9B,MAAMQ,YAAY,GAAG,IAAIV,kBAAJ,CAAuBI,YAAY,EAAnC,CAArB;IACA,OAAOM,YAAY,CAACI,WAAb,CAAyB,sBAAzB,EAAiDL,QAAjD,CAAP;EACD;;EAED,OAAO,IAAP;AACD,CAPM;AASP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,OAAO,MAAMS,mBAAmB,GAC9BT,QADiC,IAE9B;EACH,IAAIF,KAAK,IAAIL,cAAc,EAA3B,EAA+B;IAC7B,MAAMQ,YAAY,GAAG,IAAIV,kBAAJ,CAAuBI,YAAY,EAAnC,CAArB;IACA,OAAOM,YAAY,CAACI,WAAb,CAAyB,yBAAzB,EAAoDL,QAApD,CAAP;EACD;;EAED,OAAO,IAAP;AACD,CATM"}