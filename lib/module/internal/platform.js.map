{"version":3,"names":["NativeModules","Platform","ErrorCode","RNIapIos","RNIapIosSk2","RNIapModule","RNIapAmazonModule","isIos","OS","isAndroid","isAmazon","isPlay","androidNativeModule","setAndroidNativeModule","nativeModule","checkNativeAndroidAvailable","Error","E_IAP_NOT_AVAILABLE","getAndroidModule","getAndroidModuleType","module","getNativeModule","getIosModule","iosNativeModule","isStorekit2Avaiable","isAvailable","isIosStorekit2","setIosNativeModule","storekit2Mode","disable","console","warn","storekit1Mode","storekitHybridMode","info","checkNativeIOSAvailable"],"sources":["platform.ts"],"sourcesContent":["import {NativeModules, Platform} from 'react-native';\n\nimport {ErrorCode} from '../purchaseError';\n\nconst {RNIapIos, RNIapIosSk2, RNIapModule, RNIapAmazonModule} = NativeModules;\n\nexport const isIos = Platform.OS === 'ios';\nexport const isAndroid = Platform.OS === 'android';\nexport const isAmazon = isAndroid && !!RNIapAmazonModule;\nexport const isPlay = isAndroid && !!RNIapModule;\n\n// Android\n\nlet androidNativeModule = RNIapModule;\n\nexport const setAndroidNativeModule = (\n  nativeModule: typeof RNIapModule,\n): void => {\n  androidNativeModule = nativeModule;\n};\n\nexport const checkNativeAndroidAvailable = (): void => {\n  if (!RNIapModule && !RNIapAmazonModule) {\n    throw new Error(ErrorCode.E_IAP_NOT_AVAILABLE);\n  }\n};\n\n/**\n * If changing the typings of `getAndroidModule` to accommodate extra modules,\n * make sure to update `getAndroidModuleType`.\n */\nexport const getAndroidModule = ():\n  | typeof RNIapModule\n  | typeof RNIapAmazonModule => {\n  checkNativeAndroidAvailable();\n\n  return androidNativeModule\n    ? androidNativeModule\n    : RNIapModule\n    ? RNIapModule\n    : RNIapAmazonModule;\n};\n\n/**\n * Returns whether the Android in-app-purchase code is using the Android,\n * Amazon, or another store.\n */\nexport const getAndroidModuleType = (): 'android' | 'amazon' | null => {\n  const module = getAndroidModule();\n  switch (module) {\n    case RNIapModule:\n      return 'android';\n    case RNIapAmazonModule:\n      return 'amazon';\n    default:\n      return null;\n  }\n};\n\nexport const getNativeModule = ():\n  | typeof RNIapModule\n  | typeof RNIapAmazonModule\n  | typeof RNIapIos\n  | typeof RNIapIosSk2 => {\n  return isAndroid ? getAndroidModule() : getIosModule();\n};\n\n// iOS\n\nlet iosNativeModule: typeof RNIapIos | typeof RNIapIosSk2 = RNIapIos;\n\nexport const isStorekit2Avaiable = (): boolean =>\n  isIos && RNIapIosSk2?.isAvailable() === 1;\n\nexport const isIosStorekit2 = () =>\n  isIos &&\n  !!iosNativeModule &&\n  iosNativeModule === RNIapIosSk2 &&\n  isStorekit2Avaiable();\n\nexport const setIosNativeModule = (\n  nativeModule: typeof RNIapIos | typeof RNIapIosSk2,\n): void => {\n  iosNativeModule = nativeModule;\n};\n\nexport const storekit2Mode = () => {\n  iosNativeModule = RNIapIosSk2;\n  if (isStorekit2Avaiable()) {\n    RNIapIos.disable();\n    return true;\n  }\n  if (isIos) {\n    console.warn('Storekit 2 is not available on this device');\n    return false;\n  }\n  return true;\n};\n\nexport const storekit1Mode = () => {\n  iosNativeModule = RNIapIos;\n  if (isStorekit2Avaiable()) {\n    RNIapIosSk2.disable();\n    return true;\n  }\n  return false;\n};\n\nexport const storekitHybridMode = () => {\n  if (isStorekit2Avaiable()) {\n    iosNativeModule = RNIapIosSk2;\n    console.info('Using Storekit 2');\n    return true;\n  } else {\n    iosNativeModule = RNIapIos;\n    console.info('Using Storekit 1');\n    return true;\n  }\n};\n\nconst checkNativeIOSAvailable = (): void => {\n  if (!RNIapIos && !isStorekit2Avaiable()) {\n    throw new Error(ErrorCode.E_IAP_NOT_AVAILABLE);\n  }\n};\n\nexport const getIosModule = (): typeof RNIapIos | typeof RNIapIosSk2 => {\n  checkNativeIOSAvailable();\n\n  return iosNativeModule\n    ? iosNativeModule\n    : RNIapIosSk2\n    ? RNIapIosSk2\n    : RNIapIos;\n};\n"],"mappings":"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"}