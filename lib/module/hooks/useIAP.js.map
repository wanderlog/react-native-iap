{"version":3,"names":["useCallback","finishTransaction","iapFinishTransaction","getAvailablePurchases","iapGetAvailablePurchases","getProducts","iapGetProducts","getPurchaseHistory","iapGetPurchaseHistory","getSubscriptions","iapGetSubscriptions","requestPurchase","iapRequestPurchase","requestSubscription","iapRequestSubscription","useIAPContext","useIAP","connected","products","promotedProductsIOS","subscriptions","purchaseHistory","availablePurchases","currentPurchase","currentPurchaseError","initConnectionError","setProducts","setSubscriptions","setAvailablePurchases","setPurchaseHistory","setCurrentPurchase","setCurrentPurchaseError","skus","purchase","isConsumable","developerPayloadAndroid","err","productId","undefined"],"sources":["useIAP.ts"],"sourcesContent":["import {useCallback} from 'react';\n\nimport {\n  finishTransaction as iapFinishTransaction,\n  getAvailablePurchases as iapGetAvailablePurchases,\n  getProducts as iapGetProducts,\n  getPurchaseHistory as iapGetPurchaseHistory,\n  getSubscriptions as iapGetSubscriptions,\n  requestPurchase as iapRequestPurchase,\n  requestSubscription as iapRequestSubscription,\n} from '../iap';\nimport type {PurchaseError} from '../purchaseError';\nimport type {Product, Purchase, PurchaseResult, Subscription} from '../types';\n\nimport {useIAPContext} from './withIAPContext';\n\ntype IAP_STATUS = {\n  connected: boolean;\n  products: Product[];\n  promotedProductsIOS: Product[];\n  subscriptions: Subscription[];\n  purchaseHistory: Purchase[];\n  availablePurchases: Purchase[];\n  currentPurchase?: Purchase;\n  currentPurchaseError?: PurchaseError;\n  initConnectionError?: Error;\n  finishTransaction: ({\n    purchase,\n    isConsumable,\n    developerPayloadAndroid,\n  }: {\n    purchase: Purchase;\n    isConsumable?: boolean;\n    developerPayloadAndroid?: string;\n  }) => Promise<string | boolean | PurchaseResult | void>;\n  getAvailablePurchases: () => Promise<void>;\n  getPurchaseHistory: () => Promise<void>;\n  getProducts: ({skus}: {skus: string[]}) => Promise<void>;\n  getSubscriptions: ({skus}: {skus: string[]}) => Promise<void>;\n  requestPurchase: typeof iapRequestPurchase;\n  requestSubscription: typeof iapRequestSubscription;\n};\n\nexport const useIAP = (): IAP_STATUS => {\n  const {\n    connected,\n    products,\n    promotedProductsIOS,\n    subscriptions,\n    purchaseHistory,\n    availablePurchases,\n    currentPurchase,\n    currentPurchaseError,\n    initConnectionError,\n    setProducts,\n    setSubscriptions,\n    setAvailablePurchases,\n    setPurchaseHistory,\n    setCurrentPurchase,\n    setCurrentPurchaseError,\n  } = useIAPContext();\n\n  const getProducts = useCallback(\n    async ({skus}: {skus: string[]}): Promise<void> => {\n      setProducts(await iapGetProducts({skus}));\n    },\n    [setProducts],\n  );\n\n  const getSubscriptions = useCallback(\n    async ({skus}: {skus: string[]}): Promise<void> => {\n      setSubscriptions(await iapGetSubscriptions({skus}));\n    },\n    [setSubscriptions],\n  );\n\n  const getAvailablePurchases = useCallback(async (): Promise<void> => {\n    setAvailablePurchases(await iapGetAvailablePurchases());\n  }, [setAvailablePurchases]);\n\n  const getPurchaseHistory = useCallback(async (): Promise<void> => {\n    setPurchaseHistory(await iapGetPurchaseHistory());\n  }, [setPurchaseHistory]);\n\n  const finishTransaction = useCallback(\n    async ({\n      purchase,\n      isConsumable,\n      developerPayloadAndroid,\n    }: {\n      purchase: Purchase;\n      isConsumable?: boolean;\n      developerPayloadAndroid?: string;\n    }): Promise<string | boolean | PurchaseResult | void> => {\n      try {\n        return await iapFinishTransaction({\n          purchase,\n          isConsumable,\n          developerPayloadAndroid,\n        });\n      } catch (err) {\n        throw err;\n      } finally {\n        if (purchase.productId === currentPurchase?.productId) {\n          setCurrentPurchase(undefined);\n        }\n\n        if (purchase.productId === currentPurchaseError?.productId) {\n          setCurrentPurchaseError(undefined);\n        }\n      }\n    },\n    [\n      currentPurchase?.productId,\n      currentPurchaseError?.productId,\n      setCurrentPurchase,\n      setCurrentPurchaseError,\n    ],\n  );\n\n  return {\n    connected,\n    products,\n    promotedProductsIOS,\n    subscriptions,\n    purchaseHistory,\n    availablePurchases,\n    currentPurchase,\n    currentPurchaseError,\n    initConnectionError,\n    finishTransaction,\n    getProducts,\n    getSubscriptions,\n    getAvailablePurchases,\n    getPurchaseHistory,\n    requestPurchase: iapRequestPurchase,\n    requestSubscription: iapRequestSubscription,\n  };\n};\n"],"mappings":"AAAA,SAAQA,WAAR,QAA0B,OAA1B;AAEA,SACEC,iBAAiB,IAAIC,oBADvB,EAEEC,qBAAqB,IAAIC,wBAF3B,EAGEC,WAAW,IAAIC,cAHjB,EAIEC,kBAAkB,IAAIC,qBAJxB,EAKEC,gBAAgB,IAAIC,mBALtB,EAMEC,eAAe,IAAIC,kBANrB,EAOEC,mBAAmB,IAAIC,sBAPzB,QAQO,QARP;AAYA,SAAQC,aAAR,QAA4B,kBAA5B;AA6BA,OAAO,MAAMC,MAAM,GAAG,MAAkB;EACtC,MAAM;IACJC,SADI;IAEJC,QAFI;IAGJC,mBAHI;IAIJC,aAJI;IAKJC,eALI;IAMJC,kBANI;IAOJC,eAPI;IAQJC,oBARI;IASJC,mBATI;IAUJC,WAVI;IAWJC,gBAXI;IAYJC,qBAZI;IAaJC,kBAbI;IAcJC,kBAdI;IAeJC;EAfI,IAgBFhB,aAAa,EAhBjB;EAkBA,MAAMV,WAAW,GAAGL,WAAW,CAC7B,cAAmD;IAAA,IAA5C;MAACgC;IAAD,CAA4C;IACjDN,WAAW,CAAC,MAAMpB,cAAc,CAAC;MAAC0B;IAAD,CAAD,CAArB,CAAX;EACD,CAH4B,EAI7B,CAACN,WAAD,CAJ6B,CAA/B;EAOA,MAAMjB,gBAAgB,GAAGT,WAAW,CAClC,eAAmD;IAAA,IAA5C;MAACgC;IAAD,CAA4C;IACjDL,gBAAgB,CAAC,MAAMjB,mBAAmB,CAAC;MAACsB;IAAD,CAAD,CAA1B,CAAhB;EACD,CAHiC,EAIlC,CAACL,gBAAD,CAJkC,CAApC;EAOA,MAAMxB,qBAAqB,GAAGH,WAAW,CAAC,YAA2B;IACnE4B,qBAAqB,CAAC,MAAMxB,wBAAwB,EAA/B,CAArB;EACD,CAFwC,EAEtC,CAACwB,qBAAD,CAFsC,CAAzC;EAIA,MAAMrB,kBAAkB,GAAGP,WAAW,CAAC,YAA2B;IAChE6B,kBAAkB,CAAC,MAAMrB,qBAAqB,EAA5B,CAAlB;EACD,CAFqC,EAEnC,CAACqB,kBAAD,CAFmC,CAAtC;EAIA,MAAM5B,iBAAiB,GAAGD,WAAW,CACnC,eAQyD;IAAA,IARlD;MACLiC,QADK;MAELC,YAFK;MAGLC;IAHK,CAQkD;;IACvD,IAAI;MACF,OAAO,MAAMjC,oBAAoB,CAAC;QAChC+B,QADgC;QAEhCC,YAFgC;QAGhCC;MAHgC,CAAD,CAAjC;IAKD,CAND,CAME,OAAOC,GAAP,EAAY;MACZ,MAAMA,GAAN;IACD,CARD,SAQU;MACR,IAAIH,QAAQ,CAACI,SAAT,MAAuBd,eAAvB,aAAuBA,eAAvB,uBAAuBA,eAAe,CAAEc,SAAxC,CAAJ,EAAuD;QACrDP,kBAAkB,CAACQ,SAAD,CAAlB;MACD;;MAED,IAAIL,QAAQ,CAACI,SAAT,MAAuBb,oBAAvB,aAAuBA,oBAAvB,uBAAuBA,oBAAoB,CAAEa,SAA7C,CAAJ,EAA4D;QAC1DN,uBAAuB,CAACO,SAAD,CAAvB;MACD;IACF;EACF,CA3BkC,EA4BnC,CACEf,eADF,aACEA,eADF,uBACEA,eAAe,CAAEc,SADnB,EAEEb,oBAFF,aAEEA,oBAFF,uBAEEA,oBAAoB,CAAEa,SAFxB,EAGEP,kBAHF,EAIEC,uBAJF,CA5BmC,CAArC;EAoCA,OAAO;IACLd,SADK;IAELC,QAFK;IAGLC,mBAHK;IAILC,aAJK;IAKLC,eALK;IAMLC,kBANK;IAOLC,eAPK;IAQLC,oBARK;IASLC,mBATK;IAULxB,iBAVK;IAWLI,WAXK;IAYLI,gBAZK;IAaLN,qBAbK;IAcLI,kBAdK;IAeLI,eAAe,EAAEC,kBAfZ;IAgBLC,mBAAmB,EAAEC;EAhBhB,CAAP;AAkBD,CA/FM"}